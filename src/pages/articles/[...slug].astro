---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SequenceReader from '../../components/SequenceReader.astro';
import { getCollection, render } from 'astro:content';
import { normalizeMediaPath, formatDateFR } from '../../lib/media';
import { resolveArticleImages } from '../../lib/featured-image';

export async function getStaticPaths() {
  const entries = (await getCollection('articles')).filter(e => !e.data.draft);
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);
const { hero } = resolveArticleImages(entry);
const imagePath = normalizeMediaPath(hero?.path);
const heroAlt = hero?.alt ?? entry.data.imageAlt ?? entry.data.title;
const updatedDate = entry.data.updated || entry.data.date;
---
<BaseLayout
  title={entry.data.title}
  description={entry.data.description}
  image={imagePath}
  imageAlt={heroAlt}
  ogType="article"
>
  <SequenceReader
    title={entry.data.title}
    publishedLabel={formatDateFR(entry.data.date)}
    updatedLabel={formatDateFR(updatedDate)}
  >
    <Content />
  </SequenceReader>
</BaseLayout>
